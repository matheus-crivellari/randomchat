!function(s){var n,i=document.getElementById("msgPanelBody"),t=document.getElementById("inputFld"),e=document.getElementById("sendButton"),o=document.getElementById("skipButton"),l={icon:{ALERT:'<i class="fa fa-lightbulb-o"></i>',LOAD:'<i class="fa fa-circle-o-notch fa-spin"></i>'},alert:'<div class="row alert"> \t\t\t        <div class="msg alert"> \t\t\t            <p><i class="fa fa-lightbulb-o"></i> {msg}</p> \t\t\t        </div>\t\t\t    </div>',customAlert:'<div class="row alert"> \t\t\t\t\t        <div class="msg alert"> \t\t\t\t\t            <p>{ico} {msg}</p> \t\t\t\t\t        </div>\t\t\t\t\t    </div>',they:'<div class="row they">\t\t\t\t\t<div class="msg they">\t\t\t\t\t\t<p><strong>Stranger:</strong></p>\t\t\t\t\t\t<div>{msg}</div>\t\t\t\t\t</div>\t\t\t\t</div>',me:'<div class="row me">\t\t\t\t    <div class="msg me">\t\t\t\t        <p><strong>Me:</strong></p>\t\t\t\t        <div>{msg}</div>\t\t\t\t    </div>\t\t\t\t</div>'},a=16,c=13,r=10,d={flags:{holding:{shift:!1},skip:!1,alone:!0},render:{message:function(e,t,s){if(e&&t){e!=l.alert&&e!=l.customAlert&&(-1!=t.indexOf("\n")?t="<p>"+(t=t.split("\n")).join("</p><p>")+"</p>":(console.log("Tem \n"),t="<p>"+t+"</p>"));var n=e.replace("{msg}",t);e==l.customAlert&&s&&(n=n.replace("{ico}",s));var o=$(n);$(i).append(o)}},clear:function(){i.innerHTML=""},msg:{me:function(e){d.render.message(l.me,e)},they:function(e){d.render.message(l.they,e)},alert:function(e,t){t=null==t?l.icon.ALERT:t,d.render.message(l.customAlert,e,t)}}},scroll:{top:function(){i.scrollTop=0},bottom:function(){i.scrollTop=i.scrollHeight}},socket:{_namespace:"/chat",events:{PAIRFOUND:"pairfound",PAIRLOST:"pairlost",ALERT:"alert",SKIP:"skip"},connect:function(){console.log("Initializing socket.");var e=s.location.href.substr(0,s.location.href.indexOf(":")),t=(e+="://")+document.domain+":"+location.port+this._namespace;console.log("Where: ",t),n=io.connect(t),console.log("Socket up: ",n)},send:function(e){n.send(e)},receive:function(e){d.render.msg.they(e),d.scroll.bottom()},alert:function(e,t){console.log("alert: ",e),d.render.msg.alert(e)},skip:function(){console.log("Called skip."),n.emit(d.socket.events.SKIP)},onPairFound:function(e){console.log("onPairFound"),d.flags.alone=!1,d.render.clear(),d.render.msg.alert(e.msg),d.scroll.bottom(),d.input.enable()},onPairLost:function(e){console.log("pairlost"),d.flags.alone=!0,d.render.msg.alert(e.msg),d.scroll.bottom(),d.input.disable()}},input:{disable:function(){t.disabled="disabled",$(t).addClass("disabled"),e.disabled=!0,$(e).addClass("disabled")},enable:function(){t.disabled=!1,$(t).removeClass("disabled"),e.disabled=!1,$(e).removeClass("disabled")},skip:{enable:function(){var e=$(o);e.hasClass("disabled")&&e.removeClass("disabled")},disable:function(){var e=$(o);e.hasClass("disabled")||e.addClass("disabled")}}},onKeyUp:function(e){if(e.which==a&&(d.flags.holding.shift=!1),(e.which==c||e.which==r)&&!d.flags.holding.shift)return e.preventDefault(),void d.sendMessage()},onKeyDown:function(e){e.which==a&&(d.flags.holding.shift=!0)},sendMessage:function(){var e=t.value;t.value="",d.render.msg.me(e),d.socket.send(e),d.scroll.bottom()},skipConversation:function(){var e=$(o);e.hasClass("confirm")&&(e.removeClass("confirm"),e.addClass("skip")),d.flags.skip=!1,d.flags.alone=!1,d.socket.skip(),d.render.clear(),d.render.msg.alert("Connecting to someone...",l.icon.LOAD),d.scroll.bottom(),d.input.disable()},sendButtonClicked:function(){d.sendMessage()},skipButtonCliked:function(){var e=$(o);d.flags.alone?d.skipConversation():e.hasClass("confirm")?(d.flags.skip=!1,d.skipConversation()):(d.flags.skip=!0,e.hasClass("skip")&&e.removeClass("skip"),e.addClass("confirm"))},initialize:function(){console.log("Initializing."),t.addEventListener("keydown",d.onKeyDown),t.addEventListener("keyup",d.onKeyUp),e.addEventListener("click",d.sendButtonClicked),o.addEventListener("click",d.skipButtonCliked),s.addEventListener("beforeunload",function(e){var t="Are you sure you want to leave? :/";return e.preventDefault(),e.returnValue=t}),d.socket.connect(),n.on("message",d.socket.receive),n.on(d.socket.events.PAIRFOUND,function(e){d.socket.onPairFound(e)}),n.on(d.socket.events.PAIRLOST,function(e){d.socket.onPairLost(e)}),n.on(d.socket.events.ALERT,function(e){console.log("alert"),e.type?d.socket.alert(e.msg,e.type):d.socket.alert(e.msg),d.scroll.bottom()}),d.input.disable(),d.render.msg.alert("Connecting to someone...",l.icon.LOAD)}};d.initialize(),s.expose={Chat:d,MessageTemplate:l,sio:n}}(window);